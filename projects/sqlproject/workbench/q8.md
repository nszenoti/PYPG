# Question 8:

What is the trend of net revenue and orders by quarters? [4 marks]
> Hint: Find out the sum of net revenue and count the number of orders for each quarter.

---

## Solution

2 options
1. Normal query
2. Optimized via CTE

### Option 1 (Repeatation | Less Readable ❌)

```sql
SELECT
    quarter_number,
    COUNT(*) as order_count,
    ROUND(SUM(quantity * vehicle_price * (1 - discount)), 2) as net_revenue,
    ROUND(SUM(quantity * vehicle_price * (1 - discount))/COUNT(*), 2) as avg_revenue_per_order
FROM order_t
GROUP BY quarter_number
ORDER BY quarter_number;
```

### Option 2 (CTE | More Redable ✅)

```sql
WITH computed_orders AS (
    SELECT
        quarter_number,
        quantity * vehicle_price * (1 - discount) AS net_revenue_per_order
    FROM order_t
)
SELECT
    quarter_number,
    COUNT(*) AS order_count,
    ROUND(SUM(net_revenue_per_order), 2) AS net_revenue,
    ROUND(SUM(net_revenue_per_order) / COUNT(*), 2) AS avg_revenue_per_order
FROM computed_orders
GROUP BY quarter_number
ORDER BY quarter_number;
```


**Result**
```
| Quarter Number | Order Count | Net Revenue    | Avg Revenue per Order |
|----------------|-------------|----------------|------------------------|
| 1              | 310         | 18,032,549.90  | 58,169.52              |
| 2              | 262         | 13,122,995.76  | 50,087.77              |
| 3              | 229         | 8,882,298.84   | 38,787.33              |
| 4              | 199         | 8,573,149.28   | 43,081.15              |
```

---

## Observations

**Revised Observations for Q8**:

1. Parallel decline in both orders and revenue:
   - Orders: 310 → 199 (⬇️ 36%)
   - Revenue: $18.03M → $8.57M (⬇️ 52%)

2. Average revenue per order shows significant decline:
   - Q1: $58,169 (highest)
   - Q3: $38,787 (lowest)
   - Q4: Slight recovery to $43,081

3. Critical insights:
   - Steepest drop in avg order value Q1→Q3 (33% decline)
   - Q4 shows slight recovery in avg order value (+11% from Q3)
   - Double impact: losing both order volume AND order value
   - Unlike previous analysis, Q4 shows small improvement in avg order value despite lowest total orders

This revised view shows more severe revenue impact than earlier analysis, though with an interesting uptick in average order value in Q4.