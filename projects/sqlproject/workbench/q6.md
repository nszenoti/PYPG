# Question 6:

What is the trend of the number of orders by quarter? [3 marks]
> Hint: Count the number of orders for each quarter.

---

## Solution

### Option 1 (Window Function | Empty Over()) ✅

> This is bit unique and eccentric solution

```sql
SELECT
    quarter_number,
    COUNT(order_id) as order_count,
    ROUND(COUNT(order_id) * 100.0 / SUM(COUNT(order_id)) OVER (), 2) as percentage_of_total
FROM order_t
GROUP BY quarter_number
ORDER BY quarter_number;
```

> Here empty over() is used to get window of entire table so that sum() can be used !!

**REMEMBER**

✅ Key Purpose of `OVER()`:

OVER() is used to turn an aggregate function into a window function, so you can:
- Compute totals or averages across entire table or partition
- Without collapsing rows like GROUP BY does


### Option 2 (SubQuery)

BTW this is most simple logic (ie no window func used) and intutive solution

```sql
SELECT
    quarter_number,
    COUNT(order_id) AS total_orders,
    ROUND(
        COUNT(order_id) * 100.0 / (SELECT COUNT(order_id) FROM order_t),
        2
    ) AS percentage
FROM order_t
GROUP BY quarter_number
ORDER BY quarter_number;
```

### Option 3 (CTE)

```sql
WITH total_orders AS (
    SELECT COUNT(order_id) AS total FROM order_t
)
SELECT
    quarter_number,
    COUNT(order_id) AS total_orders,
    ROUND(COUNT(order_id) * 100.0 / t.total, 2) AS percentage
FROM order_t, total_orders t
GROUP BY quarter_number
ORDER BY quarter_number;

```

**Results**
```
| Quarter Number | Total Orders | Percentage (%) |
|----------------|--------------|----------------|
| 1              | 310          | 31.00          |
| 2              | 262          | 26.20          |
| 3              | 229          | 22.90          |
| 4              | 199          | 19.90          |
```

---

## Observation / Insights


1. Clear declining trend in order volume:
   - Q1 started strong (310 orders, 31%)
   - Q4 ended significantly lower (199 orders, 19.9%)
   - ~36% drop in orders from Q1 to Q4
   - This aligns with the business concern around declining sales.

2. Consistent quarter-over-quarter decline:
   - Q1→Q2: ⬇️ 15.5%
   - Q2→Q3: ⬇️ 12.6%
   - Q3→Q4: ⬇️ 13.1%

3. This order decline aligns with previous findings of decreasing customer satisfaction, suggesting a direct correlation between customer dissatisfaction and reduced order volume