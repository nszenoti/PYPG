# Question 7:
Calculate the net revenue generated by the company. What is the quarter-over-quarter % change in net revenue? [5 marks]
> Hint: Net Revenue is the amount obtained by multiplying the number of units sold by the price after deducting the discounts applied.
> Quarter over Quarter percentage change in revenue means what is the change in revenue from the subsequent quarter to the previous quarter in percentage.
> Calculate the revenue for each quarter by summing the quantity of product and the discounted vehicle price. Use the LAG function to get the revenue from the previous quarter, and then compute the quarter-over-quarter percentage change based on the current and previous revenue values.
> Ensure the results are ordered by quarter_number to maintain the correct sequence.


---

## Solution

There are 2 queries solution as ans
1. net revenue of company
2. QoQ stats for revenue



**Formulas**

- Quarter-over-Quarter (QoQ) % change =
`((Current_Quarter_Revenue - Previous_Quarter_Revenue) / Previous_Quarter_Revenue) * 100`
- Net Revenue = `quantity × (vehicle_price - discount%)`

### 1

Net revenune generated by company ✅
```sql
SELECT
    ROUND(SUM(quantity * vehicle_price * (1 - discount / 100)), 2) AS total_net_revenue
FROM order_t;
```
> 124714086.32


### 2.
Coming to question asked for **QoQ**

**Mindset**

1. Calculate net revenue = quantity × price × (1 - discount%), for each quarter
   - Use group by on quarter
2. Track prev quarter revenue at each given quarter
   - Use LAG to get previous quarter's revenue
3. Calculate QoQ change = ((current - previous)/previous) × 100

**Query**

#### **Option 1** (Preferred ✅ )
```sql
WITH
revenue_per_quarter AS (
    SELECT
        quarter_number,
        ROUND(SUM(quantity * (vehicle_price * (1 - discount / 100))), 2) AS net_revenue
    FROM order_t
    GROUP BY quarter_number
),
revenue_with_change AS (
    SELECT
        quarter_number,
        net_revenue,
        LAG(net_revenue) OVER (ORDER BY quarter_number) AS prev_revenue
    FROM revenue_per_quarter
)
SELECT
    quarter_number,
    net_revenue,
    ROUND(
        CASE
            WHEN prev_revenue IS NULL THEN NULL
            ELSE ((net_revenue - prev_revenue) / prev_revenue) * 100
        END, 2
    ) AS qoq_percentage_change
FROM revenue_with_change
ORDER BY quarter_number;
```

#### **Option 2**

```sql
WITH quarterly_revenue AS (
    SELECT
        quarter_number,
        ROUND(SUM(quantity * vehicle_price * (1 - discount/100)), 2) as revenue
    FROM order_t
    GROUP BY quarter_number
)
SELECT
    quarter_number,
    revenue,
    LAG(revenue) OVER (ORDER BY quarter_number) as prev_quarter_revenue,
    ROUND((revenue - LAG(revenue) OVER (ORDER BY quarter_number)) * 100.0 /
          LAG(revenue) OVER (ORDER BY quarter_number), 2) as qoq_change_pct
FROM quarterly_revenue
ORDER BY quarter_number;
```

Result
```
| Quarter Number | Net Revenue    | QoQ % Change    |
|----------------|----------------|-----------------|
| 1              | 39,421,580.16  | null            |
| 2              | 32,715,830.34  | -17.01          |
| 3              | 29,229,896.19  | -10.66          |
| 4              | 23,346,779.63  | -20.13          |
```

---

## Observations:

1. Significant revenue decline throughout the year:
   - Q1: $39.4M (highest)
   - Q4: $23.3M (lowest)
   - Total decline: ~41% from Q1 to Q4

2. QoQ decline accelerating:
   - Q1→Q2: -17.01%
   - Q2→Q3: -10.66%
   - Q3→Q4: -20.13% (steepest decline)

3. Revenue trend aligns with previous findings:
   - Declining order volumes
   - Decreasing customer satisfaction
   - Suggests compounding effect of fewer orders and dissatisfied customers on revenue

This paints a concerning picture of accelerating business decline requiring immediate intervention.

**Business Recommendations**:

- Investigate causes behind this consistent decline:
  - Was there a drop in orders or a change in discounting strategy?
  - Was customer sentiment (feedback) worsening across quarters? (links back to Q5)
- Consider running targeted campaigns or reviewing pricing/discounting models to recover revenue.