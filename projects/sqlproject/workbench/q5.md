# Question 5:

Find the percentage distribution of feedback from the customers. Are customers getting more dissatisfied over time? [5 marks]

> Hint: Calculate the percentage of each feedback type by using conditional aggregation.
> For each feedback category, use a CASE statement to count the occurrences and then divide by the total count of feedback for the quarter, multiplied by 100 to get the percentage.
> Finally, group by quarter_number and order the results to reflect the correct sequence.

---

## Solution

**Approaches**

1. Window Function
2. Case Statement and manual calculations (ie Hint Based)

### 1. Window Function

```sql
SELECT
    quarter_number,
    customer_feedback,
    COUNT(*) AS feedback_count,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (PARTITION BY quarter_number), 2) AS percentage
FROM order_t
WHERE customer_feedback IS NOT NULL
GROUP BY quarter_number, customer_feedback
ORDER BY quarter_number, percentage DESC;
```

Response
```
| Quarter Number | Customer Feedback | Feedback Count | Percentage |
|----------------|-------------------|----------------|------------|
| 1              | Very Good         | 93             | 30.00      |
| 1              | Good              | 89             | 28.71      |
| 1              | Okay              | 59             | 19.03      |
| 1              | Bad               | 35             | 11.29      |
| 1              | Very Bad          | 34             | 10.97      |
| 2              | Very Good         | 75             | 28.63      |
| 2              | Good              | 58             | 22.14      |
| 2              | Okay              | 53             | 20.23      |
| 2              | Very Bad          | 39             | 14.89      |
| 2              | Bad               | 37             | 14.12      |
| 3              | Bad               | 52             | 22.71      |
| 3              | Okay              | 50             | 21.83      |
| 3              | Good              | 48             | 20.96      |
| 3              | Very Bad          | 41             | 17.90      |
| 3              | Very Good         | 38             | 16.59      |
| 4              | Very Bad          | 61             | 30.65      |
| 4              | Bad               | 58             | 29.15      |
| 4              | Okay              | 40             | 20.10      |
| 4              | Very Good         | 20             | 10.05      |
| 4              | Good              | 20             | 10.05      |
```

### 2. Hint Based (New Stats Derivation) | (Case When) ✅

Mindset (CTE approach):

`matrix-style result`

1. Need counts by feedback type → used CASE for each category (Very Good to Very Bad)
2. Need percentages → total count needed as denominator for each quarter
3. Want wide format → each feedback type as separate column (ie matrix-style result)
4. Group by quarter → see trend over time

> We needed to count feedback distribution by type. So, we used CASE WHEN for each category (Very Good to Very Bad) to create separate columns per type, grouped by quarter.

```sql
WITH feedback_counts AS (
    SELECT
        quarter_number,
        COUNT(*) as total_feedbacks,
        COUNT(CASE WHEN customer_feedback = 'Very Good' THEN 1 END) as very_good,
        COUNT(CASE WHEN customer_feedback = 'Good' THEN 1 END) as good,
        COUNT(CASE WHEN customer_feedback = 'Okay' THEN 1 END) as okay,
        COUNT(CASE WHEN customer_feedback = 'Bad' THEN 1 END) as bad,
        COUNT(CASE WHEN customer_feedback = 'Very Bad' THEN 1 END) as very_bad
    FROM order_t
    WHERE customer_feedback IS NOT NULL
    GROUP BY quarter_number
)
SELECT
    quarter_number,
    ROUND(very_good * 100.0 / total_feedbacks, 2) as very_good_pct,
    ROUND(good * 100.0 / total_feedbacks, 2) as good_pct,
    ROUND(okay * 100.0 / total_feedbacks, 2) as okay_pct,
    ROUND(bad * 100.0 / total_feedbacks, 2) as bad_pct,
    ROUND(very_bad * 100.0 / total_feedbacks, 2) as very_bad_pct
FROM feedback_counts
ORDER BY quarter_number;
```

**Result**
```
| Quarter Number | Very Good (%) | Good (%) | Okay (%) | Bad (%) | Very Bad (%) |
|----------------|---------------|----------|----------|---------|---------------|
| 1              | 30.00         | 28.71    | 19.03    | 11.29   | 10.97         |
| 2              | 28.63         | 22.14    | 20.23    | 14.12   | 14.89         |
| 3              | 16.59         | 20.96    | 21.83    | 22.71   | 17.90         |
| 4              | 10.05         | 10.05    | 20.10    | 29.15   | 30.65         |
```

---


## Observations / Insights

1. Clear deterioration in customer satisfaction:
   - Q1: ~59% positive (Very Good + Good)
   - Q4: ~20% positive, with ~60% negative (Bad + Very Bad)

2. Critical shift in Q3:
   - First time negative feedback exceeds positive
   - Almost equal distribution across all categories (~20% each)

3. Dramatic Q4 decline:
   - Very Good/Good dropped to 10% each
   - Very Bad increased to 30.65%
   - Suggests urgent need for intervention

4. Drop in +ve sentiments
   - Very Good feedback declined from 30% in Q1 to 10% in Q4
   - Good also dropped significantly, from 28.7% to 10%

5. Surge in Negative Sentiment:
   - Very Bad increased 3x from 11% to 30.65% by Q4
   - Bad also doubled from 11.29% to 29.15%

Overall Trend:
- There is a clear deterioration in customer satisfaction over time (showing specific shift from positive to negative feedback)
- Signals potential issues with product quality, shipping, or post-sale service